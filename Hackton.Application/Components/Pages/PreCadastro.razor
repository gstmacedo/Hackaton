@page "/pre-cadastro"
@rendermode InteractiveServer

@inject HttpClient Http

<div class="container mt-4">
    <div class="card shadow-sm">
        <div class="card-body">

            <h4 class="mb-3">Pré-Cadastro do Aluno</h4>

            @if (!string.IsNullOrEmpty(mensagem))
            {
                <div class="alert @classeMensagem">@mensagem</div>
            }

            <EditForm Model="model" OnValidSubmit="Enviar">
                <DataAnnotationsValidator />
                <ValidationSummary />

                <div class="mb-3">
                    <label class="form-label">Email do aluno</label>
                    <InputText class="form-control" @bind-Value="model.Email" />
                </div>

                <button class="btn btn-primary" disabled="@carregando">
                    @if (carregando)
                    {
                        <span class="spinner-border spinner-border-sm"></span>
                    }
                    Enviar Email
                </button>
            </EditForm>

        </div>
    </div>
</div>

@code {

    private PreCadastroRequest model = new();
    private string? mensagem;
    private string classeMensagem = "alert-success";
    private bool carregando = false;

    private async Task Enviar()
    {
        carregando = true;
        mensagem = null;

        var response = await Http.PostAsJsonAsync(
            "http://localhost:5084/PreCadastro/Create",
            model
        );


        if (response.IsSuccessStatusCode)
        {
            mensagem = "Convite enviado com sucesso!";
            classeMensagem = "alert-success";
            model = new();
        }
        else
        {
            mensagem = "Erro ao enviar convite.";
            classeMensagem = "alert-danger";
        }

        carregando = false;
    }
}
